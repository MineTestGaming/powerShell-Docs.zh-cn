---
ms.date: 06/12/2017
contributor: JKeithB, SydneyhSmith
keywords: 库,powershell,cmdlet,psgallery
description: 面向发行者的指南
title: PowerShell 库发布指南和最佳做法
ms.openlocfilehash: c58b23b0021e0745ee690a78f7e42c821d59cdb0
ms.sourcegitcommit: 0907b8c6322d2c7c61b17f8168d53452c8964b41
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/05/2020
ms.locfileid: "87777853"
---
# <a name="powershellgallery-publishing-guidelines-and-best-practices"></a><span data-ttu-id="af2b6-104">PowerShell 库发布指南和最佳做法</span><span class="sxs-lookup"><span data-stu-id="af2b6-104">PowerShellGallery Publishing Guidelines and Best Practices</span></span>

<span data-ttu-id="af2b6-105">本文介绍了 Microsoft 团队使用的推荐步骤，以确保发布到 PowerShell 库的包将被广泛采用，并根据 PowerShell 库处理清单数据的方式和大量 PowerShell 库用户的反馈来为用户提供高价值包。</span><span class="sxs-lookup"><span data-stu-id="af2b6-105">This article describes recommended steps used by Microsoft teams to ensure the packages published to the PowerShell Gallery will be widely adopted and provide high value to users, based on how the PowerShell Gallery handles manifest data and on feedback from large numbers of PowerShell Gallery users.</span></span> <span data-ttu-id="af2b6-106">按照这些指南发布的包的安装和受信任几率更高，并且更有可能会吸引更多用户。</span><span class="sxs-lookup"><span data-stu-id="af2b6-106">Packages that are published following these guidelines will be more likely to be installed, trusted, and attract more users.</span></span>

<span data-ttu-id="af2b6-107">下面的指南介绍了高质量 PowerShell 库包有哪些关键要素、哪些是最重要的可选清单设置、如何使用初始审阅者的反馈和 [Powershell 脚本分析器](https://aka.ms/psscriptanalyzer)改进代码、如何对模块进行版本控制，以及有关如何使用已共享内容的文档、测试和示例。</span><span class="sxs-lookup"><span data-stu-id="af2b6-107">Included below are guidelines for what makes a good PowerShell Gallery package, what optional Manifest settings are most important, improving your code with feedback from initial reviewers and [Powershell Script Analyzer](https://aka.ms/psscriptanalyzer), versioning your module, documentation, tests and examples for how to use what you have shared.</span></span> <span data-ttu-id="af2b6-108">本文档的大部分内容遵循有关发布[高质量 DSC 资源模块](https://github.com/PowerShell/DscResources/blob/master/HighQualityModuleGuidelines.md)的指南。</span><span class="sxs-lookup"><span data-stu-id="af2b6-108">Much of this documentation follows the guidelines for publishing [High Quality DSC Resource Modules](https://github.com/PowerShell/DscResources/blob/master/HighQualityModuleGuidelines.md).</span></span>

<span data-ttu-id="af2b6-109">有关将包发布到 PowerShell 库的机制，请参阅[创建和发布包](../how-to/publishing-packages/publishing-a-package.md)。</span><span class="sxs-lookup"><span data-stu-id="af2b6-109">For the mechanics of publishing a package to the PowerShell Gallery, see [Creating and Publishing a Package](../how-to/publishing-packages/publishing-a-package.md).</span></span>

<span data-ttu-id="af2b6-110">欢迎随时提供有关这些指南的反馈。</span><span class="sxs-lookup"><span data-stu-id="af2b6-110">Feedback on these guidelines is welcomed.</span></span> <span data-ttu-id="af2b6-111">如有任何反馈，请在我们的 [GitHub 文档存储库](https://github.com/powershell/powershell-docs/issues)中记录待解决问题。</span><span class="sxs-lookup"><span data-stu-id="af2b6-111">If you do have feedback, please open issues in our [GitHub documentation repository](https://github.com/powershell/powershell-docs/issues).</span></span>

## <a name="best-practices-for-publishing-packages"></a><span data-ttu-id="af2b6-112">发布包的最佳做法</span><span class="sxs-lookup"><span data-stu-id="af2b6-112">Best practices for publishing packages</span></span>

<span data-ttu-id="af2b6-113">下面按名义上的优先级顺序列出了 PowerShell 库项用户认为重要的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="af2b6-113">The following best practices are what the users of PowerShell Gallery items say is important, and are listed in nominal priority order.</span></span> <span data-ttu-id="af2b6-114">按照下面这些指南发布包会大大提升它们被其他用户下载和采用的几率。</span><span class="sxs-lookup"><span data-stu-id="af2b6-114">Packages that follow these guidelines are far more likely to be downloaded and adopted by others.</span></span>

- <span data-ttu-id="af2b6-115">使用 PSScriptAnalyzer</span><span class="sxs-lookup"><span data-stu-id="af2b6-115">Use PSScriptAnalyzer</span></span>
- <span data-ttu-id="af2b6-116">添加文档和示例</span><span class="sxs-lookup"><span data-stu-id="af2b6-116">Include documentation and examples</span></span>
- <span data-ttu-id="af2b6-117">及时响应反馈</span><span class="sxs-lookup"><span data-stu-id="af2b6-117">Be responsive to feedback</span></span>
- <span data-ttu-id="af2b6-118">提供模块（而不是脚本）</span><span class="sxs-lookup"><span data-stu-id="af2b6-118">Provide modules rather than scripts</span></span>
- <span data-ttu-id="af2b6-119">提供项目网站链接</span><span class="sxs-lookup"><span data-stu-id="af2b6-119">Provide links to a project site</span></span>
- <span data-ttu-id="af2b6-120">使用兼容 PSEdition 和平台对包进行标记</span><span class="sxs-lookup"><span data-stu-id="af2b6-120">Tag your package with the compatible PSEdition(s) and platforms</span></span>
- <span data-ttu-id="af2b6-121">随模块添加测试</span><span class="sxs-lookup"><span data-stu-id="af2b6-121">Include tests with your modules</span></span>
- <span data-ttu-id="af2b6-122">添加和/或链接到许可条款</span><span class="sxs-lookup"><span data-stu-id="af2b6-122">Include and/or link to license terms</span></span>
- <span data-ttu-id="af2b6-123">对代码进行签名</span><span class="sxs-lookup"><span data-stu-id="af2b6-123">Sign your code</span></span>
- <span data-ttu-id="af2b6-124">遵循 [SemVer](https://semver.org/) 指南进行版本控制</span><span class="sxs-lookup"><span data-stu-id="af2b6-124">Follow [SemVer](https://semver.org/) guidelines for versioning</span></span>
- <span data-ttu-id="af2b6-125">使用“常见 PowerShell 库标记”中收录的常见标记</span><span class="sxs-lookup"><span data-stu-id="af2b6-125">Use common tags, as documented in Common PowerShell Gallery tags</span></span>
- <span data-ttu-id="af2b6-126">使用本地存储库测试发布</span><span class="sxs-lookup"><span data-stu-id="af2b6-126">Test publishing using a local repository</span></span>
- <span data-ttu-id="af2b6-127">使用 PowerShellGet 发布</span><span class="sxs-lookup"><span data-stu-id="af2b6-127">Use PowerShellGet to publish</span></span>

<span data-ttu-id="af2b6-128">下面的各个部分简要介绍了上述每种最佳做法。</span><span class="sxs-lookup"><span data-stu-id="af2b6-128">Each of these is covered briefly in the sections below.</span></span>

## <a name="use-psscriptanalyzer"></a><span data-ttu-id="af2b6-129">使用 PSScriptAnalyzer</span><span class="sxs-lookup"><span data-stu-id="af2b6-129">Use PSScriptAnalyzer</span></span>

<span data-ttu-id="af2b6-130">[PSScriptAnalyzer](https://www.powershellgallery.com/packages/PSScriptAnalyzer) 是一款用于处理 PowerShell 代码的免费静态代码分析工具。</span><span class="sxs-lookup"><span data-stu-id="af2b6-130">[PSScriptAnalyzer](https://www.powershellgallery.com/packages/PSScriptAnalyzer) is a free static code analysis tool that works on PowerShell code.</span></span> <span data-ttu-id="af2b6-131">PSScriptAnalyzer  可发现 PowerShell 代码中存在的最常见问题，通常还会建议如何解决问题。</span><span class="sxs-lookup"><span data-stu-id="af2b6-131">**PSScriptAnalyzer** will identify the most common issues seen in PowerShell code, and often a recommendation for how to fix the issue.</span></span> <span data-ttu-id="af2b6-132">此工具易于使用，并将问题分类为“错误”（必须解决的严重问题）、“警告”（需要查看并应解决的问题）和“信息”（值得参阅最佳做法的问题）。</span><span class="sxs-lookup"><span data-stu-id="af2b6-132">The tool is easy to use, and categorizes the issues as Errors (severe, must be addressed), Warning (need to be reviewed and should be addressed), and Information (worth checking out for best practices).</span></span> <span data-ttu-id="af2b6-133">所有发布到 PowerShell 库的包都会使用 PSScriptAnalyzer  进行扫描，任何错误都会向所有者报告，并且必须予以修复。</span><span class="sxs-lookup"><span data-stu-id="af2b6-133">All packages published to the PowerShell Gallery will be scanned using **PSScriptAnalyzer**, and any errors will be reported back to the owner and must be addressed.</span></span>

<span data-ttu-id="af2b6-134">最佳做法是使用 `-Recurse` 和 `-Severity` 警告运行 `Invoke-ScriptAnalyzer`。</span><span class="sxs-lookup"><span data-stu-id="af2b6-134">The best practice is to run `Invoke-ScriptAnalyzer` with `-Recurse` and `-Severity` Warning.</span></span>

<span data-ttu-id="af2b6-135">查看结果并确保：</span><span class="sxs-lookup"><span data-stu-id="af2b6-135">Review the results, and ensure that:</span></span>

- <span data-ttu-id="af2b6-136">已更正或修复文档中的所有错误。</span><span class="sxs-lookup"><span data-stu-id="af2b6-136">All Errors are corrected or addressed in your documentation.</span></span>
- <span data-ttu-id="af2b6-137">已查看并在必要时解决所有警告。</span><span class="sxs-lookup"><span data-stu-id="af2b6-137">All Warnings are reviewed, and addressed where applicable.</span></span>

<span data-ttu-id="af2b6-138">强烈建议从 PowerShell 库下载包的用户运行 **PSScriptAnalyzer**，并评估所有错误和警告。</span><span class="sxs-lookup"><span data-stu-id="af2b6-138">Users who download packages from the PowerShell Gallery are strongly encouraged to run **PSScriptAnalyzer** and evaluate all Errors and Warnings.</span></span> <span data-ttu-id="af2b6-139">如果用户看到 PSScriptAnalyzer  报告的错误，他们很有可能会与包所有者进行联系。</span><span class="sxs-lookup"><span data-stu-id="af2b6-139">Users are very likely to contact package owners if they see that there's an error reported by **PSScriptAnalyzer**.</span></span> <span data-ttu-id="af2b6-140">如果包有充分理由保留标记为错误的代码，请将相应信息添加到文档中，以免多次回答同一问题。</span><span class="sxs-lookup"><span data-stu-id="af2b6-140">If there's a compelling reason for your package to keep code that is flagged as an error, add that information to your documentation to avoid having to answer the same question many times.</span></span>

## <a name="include-documentation-and-examples"></a><span data-ttu-id="af2b6-141">添加文档和示例</span><span class="sxs-lookup"><span data-stu-id="af2b6-141">Include documentation and examples</span></span>

<span data-ttu-id="af2b6-142">文档和示例是确保用户可以利用所有已共享代码的最佳方式。</span><span class="sxs-lookup"><span data-stu-id="af2b6-142">Documentation and examples are the best way to ensure users can take advantage of any shared code.</span></span>

<span data-ttu-id="af2b6-143">文档是在发布到 PowerShell Gallery 的包中所添加的最实用内容。</span><span class="sxs-lookup"><span data-stu-id="af2b6-143">Documentation is the most helpful thing to include in packages published to the PowerShell Gallery.</span></span>
<span data-ttu-id="af2b6-144">用户通常会忽略没有文档的包，因为只能通过阅读代码来了解包的用途和使用方式。</span><span class="sxs-lookup"><span data-stu-id="af2b6-144">Users will generally bypass packages without documentation, as the alternative is to read the code to understand what the package is and how to use it.</span></span> <span data-ttu-id="af2b6-145">有多篇文章都介绍了如何为 PowerShell 包提供文档，包括：</span><span class="sxs-lookup"><span data-stu-id="af2b6-145">There are several articles available about how to provide documentation with PowerShell packages, including:</span></span>

- <span data-ttu-id="af2b6-146">[如何编写 Cmdlet 帮助](https://go.microsoft.com/fwlink/?LinkID=123415)中介绍了有关如何提供帮助的指南。</span><span class="sxs-lookup"><span data-stu-id="af2b6-146">Guidelines for providing help are in [How to Write Cmdlet Help](https://go.microsoft.com/fwlink/?LinkID=123415).</span></span>
- <span data-ttu-id="af2b6-147">创建 cmdlet 帮助，这是最适合任何 PowerShell 脚本、函数或 cmdlet 的方法。</span><span class="sxs-lookup"><span data-stu-id="af2b6-147">Creating cmdlet help, which is the best approach for any PowerShell script, function, or cmdlet.</span></span>
  <span data-ttu-id="af2b6-148">有关如何创建 cmdlet 帮助的信息，请从[如何编写 Cmdlet 帮助](https://go.microsoft.com/fwlink/?LinkID=123415)入手。</span><span class="sxs-lookup"><span data-stu-id="af2b6-148">For information about how to create cmdlet help, start with [How to Write Cmdlet Help](https://go.microsoft.com/fwlink/?LinkID=123415).</span></span>
  <span data-ttu-id="af2b6-149">若要在脚本中添加帮助，请参阅[关于基于评论的帮助](/powershell/module/microsoft.powershell.core/about/about_comment_based_help)。</span><span class="sxs-lookup"><span data-stu-id="af2b6-149">To add help within a script, see [About Comment Based Help](/powershell/module/microsoft.powershell.core/about/about_comment_based_help).</span></span>
- <span data-ttu-id="af2b6-150">许多模块还包括文本格式的文档，如 MarkDown 文件。</span><span class="sxs-lookup"><span data-stu-id="af2b6-150">Many modules also include documentation in text format, such as MarkDown files.</span></span> <span data-ttu-id="af2b6-151">当在 Markdown 作为一种广泛使用格式的 GitHub 中有项目网站时，这尤为有用。</span><span class="sxs-lookup"><span data-stu-id="af2b6-151">This can be particularly helpful when there's a project site in GitHub, where Markdown is a heavily used format.</span></span> <span data-ttu-id="af2b6-152">最佳做法是使用 [GitHub 式 Markdown](https://help.github.com/categories/writing-on-github/)。</span><span class="sxs-lookup"><span data-stu-id="af2b6-152">The best practice is to use [GitHub-flavored Markdown](https://help.github.com/categories/writing-on-github/).</span></span>

<span data-ttu-id="af2b6-153">示例可以向用户展示如何使用包。</span><span class="sxs-lookup"><span data-stu-id="af2b6-153">Examples show users how the package is intended to be used.</span></span> <span data-ttu-id="af2b6-154">许多开发者都表示，他们在查看文档之前会先查看示例，了解如何使用某项。</span><span class="sxs-lookup"><span data-stu-id="af2b6-154">Many developers will say that they look at examples before documentation to understand how to use something.</span></span> <span data-ttu-id="af2b6-155">最适合的示例不仅展示了基本用法，还展示了模拟实际用例，同时对代码进行了详细注释。</span><span class="sxs-lookup"><span data-stu-id="af2b6-155">The best types of examples show basic use, plus a simulated realistic use case, and the code is well-commented.</span></span> <span data-ttu-id="af2b6-156">发布到 PowerShell 库的模块的示例应位于模块根下的 Examples 文件夹中。</span><span class="sxs-lookup"><span data-stu-id="af2b6-156">Examples for modules published to the PowerShell Gallery should be in an Examples folder under the module root.</span></span>

<span data-ttu-id="af2b6-157">`Examples\RegistryResource` 文件夹下的 [PSDscResource 模块](https://www.powershellgallery.com/packages/PSDscResources)中包含优质示例模式。</span><span class="sxs-lookup"><span data-stu-id="af2b6-157">A good pattern for examples can be found in the [PSDscResource module](https://www.powershellgallery.com/packages/PSDscResources) under the `Examples\RegistryResource` folder.</span></span> <span data-ttu-id="af2b6-158">具体包含四个示例用例，每个文件的顶部都简要说明了要演示的内容。</span><span class="sxs-lookup"><span data-stu-id="af2b6-158">There are four sample use cases with a brief description at the top of each file that documents what is being demonstrated.</span></span>

## <a name="manage-dependencies"></a><span data-ttu-id="af2b6-159">管理依赖项</span><span class="sxs-lookup"><span data-stu-id="af2b6-159">Manage Dependencies</span></span>

<span data-ttu-id="af2b6-160">请务必在模块清单中指定你的模块所依赖的模块。</span><span class="sxs-lookup"><span data-stu-id="af2b6-160">It's important to specify modules that your module is dependent on in the Module Manifest.</span></span> <span data-ttu-id="af2b6-161">这样，最终用户就不必为安装你的模块所依赖的正确版本模块而担心了。</span><span class="sxs-lookup"><span data-stu-id="af2b6-161">This allows the end user to not have to worry about installing the proper versions of modules that yours take a dependency on.</span></span> <span data-ttu-id="af2b6-162">若要指定依赖模块，应使用模块清单中的“必需模块”字段。</span><span class="sxs-lookup"><span data-stu-id="af2b6-162">To specify dependent modules, you should use the required module field in the module manifest.</span></span> <span data-ttu-id="af2b6-163">这会在导入你的模块之前，将列出的所有模块都加载到全局环境中，除非它们已加载。</span><span class="sxs-lookup"><span data-stu-id="af2b6-163">This will load any listed modules into the global environment prior to importing your module unless they've already been loaded.</span></span> <span data-ttu-id="af2b6-164">例如，一些模块可能已由其他模块加载。</span><span class="sxs-lookup"><span data-stu-id="af2b6-164">For example, some modules may already be loaded by a different module.</span></span> <span data-ttu-id="af2b6-165">也可以使用 RequiredVersion  字段（而不是 ModuleVersion  字段）指定要加载的特定版本。</span><span class="sxs-lookup"><span data-stu-id="af2b6-165">It's also possible to specify a specific version to load using the **RequiredVersion** field rather than the **ModuleVersion** field.</span></span> <span data-ttu-id="af2b6-166">使用 ModuleVersion  会加载最新版本（在已指定最低版本的情况下）。</span><span class="sxs-lookup"><span data-stu-id="af2b6-166">When using **ModuleVersion**, it will load the newest version available with a minimum of the version specified.</span></span> <span data-ttu-id="af2b6-167">如果不使用 RequiredVersion  字段指定特定版本，请务必监视必需模块的版本更新。</span><span class="sxs-lookup"><span data-stu-id="af2b6-167">When not using the **RequiredVersion** field, to specify a specific version it's important to monitor version updates to the required module.</span></span> <span data-ttu-id="af2b6-168">特别重要的是，要注意任何可能会影响用户的模块体验的中断性变更。</span><span class="sxs-lookup"><span data-stu-id="af2b6-168">It's especially important to be aware of any breaking changes that could affect the user experience with your module.</span></span>

```powershell
Example: RequiredModules = @(@{ModuleName="myDependentModule"; ModuleVersion="2.0"; Guid="cfc45206-1e49-459d-a8ad-5b571ef94857"})

Example: RequiredModules = @(@{ModuleName="myDependentModule"; RequiredVersion="1.5"; Guid="cfc45206-1e49-459d-a8ad-5b571ef94857"})
```

## <a name="respond-to-feedback"></a><span data-ttu-id="af2b6-169">及时反馈响应</span><span class="sxs-lookup"><span data-stu-id="af2b6-169">Respond to feedback</span></span>

<span data-ttu-id="af2b6-170">及时响应反馈的包所有者会受到社区的高度重视。</span><span class="sxs-lookup"><span data-stu-id="af2b6-170">Package owners who respond properly to feedback are highly valued by the community.</span></span> <span data-ttu-id="af2b6-171">请务必及时响应提供建设性反馈的用户，因为他们对包非常感兴趣并尝试帮助改进包。</span><span class="sxs-lookup"><span data-stu-id="af2b6-171">Users who provide constructive feedback are important to respond to, as they're interested enough in the package to try to help improve it.</span></span>

<span data-ttu-id="af2b6-172">PowerShell 库支持以下两种反馈方法：</span><span class="sxs-lookup"><span data-stu-id="af2b6-172">There are two feedback methods available in the PowerShell Gallery:</span></span>

- <span data-ttu-id="af2b6-173">联系人所有者：这样，用户可以向包所有者发送电子邮件。</span><span class="sxs-lookup"><span data-stu-id="af2b6-173">Contact Owner: This allows a user to send an email to the package owner.</span></span> <span data-ttu-id="af2b6-174">作为包所有者，请务必监视用于 PowerShell 库包的电子邮件地址，并及时响应所提出的问题。</span><span class="sxs-lookup"><span data-stu-id="af2b6-174">As a package owner, is important to monitor the email address used with the PowerShell Gallery packages, and respond to issues that are raised.</span></span> <span data-ttu-id="af2b6-175">这种方法有一个缺点，就是只有用户和所有者才能看到通信，因此所有者可能需要多次回答同一问题。</span><span class="sxs-lookup"><span data-stu-id="af2b6-175">The one disadvantage to this method is that only the user and owner will ever see the communication, so the owner may have to answer the same question many times.</span></span>
- <span data-ttu-id="af2b6-176">评论：包网页的底部有“评论”  字段。</span><span class="sxs-lookup"><span data-stu-id="af2b6-176">Comments: At the bottom of the package page is a **Comment** field.</span></span> <span data-ttu-id="af2b6-177">此系统的优点是，其他用户可以看到评论和响应，这样就减少了必须回答每个问题的次数。</span><span class="sxs-lookup"><span data-stu-id="af2b6-177">The advantage to this system is that other users can see the comments and responses, which reduces the number of times any single question must be answered.</span></span> <span data-ttu-id="af2b6-178">强烈建议包所有者关注对每个包发表的评论。</span><span class="sxs-lookup"><span data-stu-id="af2b6-178">As a package owner, it's strongly recommended that you follow the comments made for each package.</span></span> <span data-ttu-id="af2b6-179">若要详细了解如何执行此操作，请参阅[通过社交媒体或发表评论提供反馈](../how-to/working-with-packages/social-media-feedback.md)。</span><span class="sxs-lookup"><span data-stu-id="af2b6-179">See [Providing Feedback via Social Media or Comments](../how-to/working-with-packages/social-media-feedback.md) for details on how to do that.</span></span>

<span data-ttu-id="af2b6-180">建设性地响应反馈的所有者将受到社区的重视。</span><span class="sxs-lookup"><span data-stu-id="af2b6-180">Owners who respond to feedback constructively are appreciated by the community.</span></span> <span data-ttu-id="af2b6-181">使用报表中的机会来请求详细信息。</span><span class="sxs-lookup"><span data-stu-id="af2b6-181">Use the opportunity in the report to request more information.</span></span> <span data-ttu-id="af2b6-182">如果需要，请提供一种解决方法，或确定更新是否解决了问题。</span><span class="sxs-lookup"><span data-stu-id="af2b6-182">If needed, provide a workaround, or identify if an update fixes a problem.</span></span>

<span data-ttu-id="af2b6-183">如果在这些信道中发现了任何不当行为，可以使用 PowerShell 库的“报告滥用行为”功能来联系库管理员。</span><span class="sxs-lookup"><span data-stu-id="af2b6-183">If there's inappropriate behavior observed from either of these communication channels, use the Report Abuse feature of the PowerShell Gallery to contact the Gallery Administrators.</span></span>

## <a name="modules-versus-scripts"></a><span data-ttu-id="af2b6-184">模块与脚本</span><span class="sxs-lookup"><span data-stu-id="af2b6-184">Modules Versus Scripts</span></span>

<span data-ttu-id="af2b6-185">与其他用户共享脚本非常棒，可以为其他用户提供有关如何解决可能遇到的问题的示例。</span><span class="sxs-lookup"><span data-stu-id="af2b6-185">Sharing a script with other users is great, and provides others with examples of how to solve problems they may have.</span></span> <span data-ttu-id="af2b6-186">问题在于，PowerShell 库中的脚本为单个文件，不含单独的文档、示例和测试。</span><span class="sxs-lookup"><span data-stu-id="af2b6-186">The issue is that scripts in the PowerShell Gallery are single files without separate documentation, examples, and tests.</span></span>

<span data-ttu-id="af2b6-187">PowerShell 模块采用文件夹结构，可以随包添加多个文件夹和文件。</span><span class="sxs-lookup"><span data-stu-id="af2b6-187">PowerShell Modules have a folder structure that allows multiple folders and files to be included with the package.</span></span> <span data-ttu-id="af2b6-188">使用模块结构，可以添加我们列为最佳做法的其他包，包括 cmdlet 帮助、文档、示例和测试。</span><span class="sxs-lookup"><span data-stu-id="af2b6-188">The module structure enables including the other packages we list as best practices: cmdlet help, documentation, examples, and tests.</span></span> <span data-ttu-id="af2b6-189">最大缺点是模块内的脚本必须作为函数进行公开和使用。</span><span class="sxs-lookup"><span data-stu-id="af2b6-189">The biggest disadvantage is that a script inside a module must be exposed and used as a function.</span></span> <span data-ttu-id="af2b6-190">若要了解如何创建模块，请参阅[编写 Windows PowerShell 模块](/powershell/scripting/developer/module/writing-a-windows-powershell-module)。</span><span class="sxs-lookup"><span data-stu-id="af2b6-190">For information on how to create a module, see [Writing a Windows PowerShell Module](/powershell/scripting/developer/module/writing-a-windows-powershell-module).</span></span>

<span data-ttu-id="af2b6-191">在某些情况下，脚本可以提升用户体验，特别是在使用 DSC 配置时。</span><span class="sxs-lookup"><span data-stu-id="af2b6-191">There are situations where a script provides a better experience for the user, particularly with DSC configurations.</span></span> <span data-ttu-id="af2b6-192">适用于 DSC 配置的最佳做法是，将配置作为脚本发布，并随附包含文档、示例和测试的模块。</span><span class="sxs-lookup"><span data-stu-id="af2b6-192">The best practice for DSC configurations is to publish the configuration as a script with an accompanying module that contains the docs, examples, and tests.</span></span> <span data-ttu-id="af2b6-193">该脚本使用 `RequiredModules = @(Name of the Module)` 列出附带的模块。</span><span class="sxs-lookup"><span data-stu-id="af2b6-193">The script lists the accompanying module using `RequiredModules = @(Name of the Module)`.</span></span> <span data-ttu-id="af2b6-194">这种方法可用于任何脚本。</span><span class="sxs-lookup"><span data-stu-id="af2b6-194">This approach can be used with any script.</span></span>

<span data-ttu-id="af2b6-195">遵循其他最佳做法的独立脚本可为其他用户带来真正的价值。</span><span class="sxs-lookup"><span data-stu-id="af2b6-195">Standalone scripts that follow the other best practices provide real value to other users.</span></span> <span data-ttu-id="af2b6-196">向 PowerShell 库发布脚本时，强烈建议提供基于评论的文档和项目网站链接。</span><span class="sxs-lookup"><span data-stu-id="af2b6-196">Providing comment-based documentation and a link to a Project Site are highly recommended when publishing a script to the PowerShell Gallery.</span></span>

## <a name="provide-a-link-to-a-project-site"></a><span data-ttu-id="af2b6-197">提供项目网站链接</span><span class="sxs-lookup"><span data-stu-id="af2b6-197">Provide a link to a project site</span></span>

<span data-ttu-id="af2b6-198">发行者可以在项目网站上直接与 PowerShell 库包的用户进行交互。</span><span class="sxs-lookup"><span data-stu-id="af2b6-198">A Project Site is where a publisher can interact directly with the users of their PowerShell Gallery packages.</span></span> <span data-ttu-id="af2b6-199">用户更倾向于提供项目网站链接的包，因为这样可以更轻松地获取有关包的信息。</span><span class="sxs-lookup"><span data-stu-id="af2b6-199">Users prefer packages that provide this, as it allows them to get information about the package more easily.</span></span> <span data-ttu-id="af2b6-200">PowerShell 库中的许多包在 GitHub 中进行开发，而其他包则由具有专属网站的组织提供。</span><span class="sxs-lookup"><span data-stu-id="af2b6-200">Many packages in the PowerShell Gallery are developed in GitHub, others are provided by organizations with a dedicated web presence.</span></span> <span data-ttu-id="af2b6-201">其中每个网站都可被视为项目网站。</span><span class="sxs-lookup"><span data-stu-id="af2b6-201">Each of these can be considered a project site.</span></span>

<span data-ttu-id="af2b6-202">可以在清单的 PSData 部分中添加 ProjectURI，从而添加链接，如下所示：</span><span class="sxs-lookup"><span data-stu-id="af2b6-202">Adding a link is done by including ProjectURI in the PSData section of the manifest as follows:</span></span>

```
  # A URL to the main website for this project.
  ProjectUri = 'https://github.com/powershell/powershell'
```

<span data-ttu-id="af2b6-203">提供 ProjectURI 时，PowerShell 库在包网页的左侧添加项目网站链接。</span><span class="sxs-lookup"><span data-stu-id="af2b6-203">When a ProjectURI is provided, the PowerShell Gallery will include a link to the Project Site on the left side of the package page.</span></span>

## <a name="tag-your-package-with-the-compatible-pseditions-and-platforms"></a><span data-ttu-id="af2b6-204">使用兼容 PSEdition 和平台对包进行标记</span><span class="sxs-lookup"><span data-stu-id="af2b6-204">Tag your package with the compatible PSEdition(s) and platforms</span></span>

<span data-ttu-id="af2b6-205">使用以下标记可向用户演示适用于其环境的包：</span><span class="sxs-lookup"><span data-stu-id="af2b6-205">Use the following tags to demonstrate to users which packages will work well with their environment:</span></span>

- <span data-ttu-id="af2b6-206">PSEdition_Desktop：与 Windows PowerShell 兼容的包</span><span class="sxs-lookup"><span data-stu-id="af2b6-206">PSEdition_Desktop: Packages that are compatible with Windows PowerShell</span></span>
- <span data-ttu-id="af2b6-207">PSEdition_Core：与 PowerShell Core 兼容的包</span><span class="sxs-lookup"><span data-stu-id="af2b6-207">PSEdition_Core: Packages that are compatible with PowerShell Core</span></span>
- <span data-ttu-id="af2b6-208">Windows：与 Windows 操作系统兼容的包</span><span class="sxs-lookup"><span data-stu-id="af2b6-208">Windows: Packages that are compatible with the Windows Operating System</span></span>
- <span data-ttu-id="af2b6-209">Linux：与 Linux 操作系统兼容的包</span><span class="sxs-lookup"><span data-stu-id="af2b6-209">Linux: Packages that are compatible with Linux Operating Systems</span></span>
- <span data-ttu-id="af2b6-210">MacOS：与 Mac 操作系统兼容的包</span><span class="sxs-lookup"><span data-stu-id="af2b6-210">MacOS: Packages that are compatible with the Mac Operating System</span></span>

<span data-ttu-id="af2b6-211">使用兼容平台标记包之后，该包将包含在搜索结果左窗格上的“库”搜索筛选器中。</span><span class="sxs-lookup"><span data-stu-id="af2b6-211">By tagging your package with the compatible platform(s) it will be included in the Gallery search filters on the left pane of the search results.</span></span> <span data-ttu-id="af2b6-212">如果在 GitHub 上托管包，则在标记包时，还可以充分利用 [PowerShell 库兼容性保护程序](https://img.shields.io/powershellgallery/p/:packageName.svg)
![兼容性保护程序示例](media/publishing-guidelines/CosmosDB.svg)。</span><span class="sxs-lookup"><span data-stu-id="af2b6-212">If you host your package on GitHub, when you tag your package, you can also take advantage of our [PowerShell Gallery compatibility shields](https://img.shields.io/powershellgallery/p/:packageName.svg)
![compatibility shield example](media/publishing-guidelines/CosmosDB.svg).</span></span>

## <a name="include-tests"></a><span data-ttu-id="af2b6-213">添加测试</span><span class="sxs-lookup"><span data-stu-id="af2b6-213">Include tests</span></span>

<span data-ttu-id="af2b6-214">添加包含开放源代码的测试对于用户来说很重要，因为这样可以让用户相信所验证的内容，并展示代码的工作原理。</span><span class="sxs-lookup"><span data-stu-id="af2b6-214">Including tests with open-source code is important to users, as it gives them assurance about what you validate, and provides information on how your code works.</span></span> <span data-ttu-id="af2b6-215">此外，如果用户修改代码来适应自己的环境，这样做还可以确保用户不会破坏原始功能。</span><span class="sxs-lookup"><span data-stu-id="af2b6-215">It also allows users to ensure they don't break your original functionality if they modify your code to fit their environment.</span></span>

<span data-ttu-id="af2b6-216">强烈建议编写测试，以利用专为 PowerShell 设计的 Pester 测试框架。</span><span class="sxs-lookup"><span data-stu-id="af2b6-216">It's strongly recommended that tests be written to take advantage of the Pester test framework, which has been designed specifically for PowerShell.</span></span> <span data-ttu-id="af2b6-217">可从 [GitHub](https://github.com/Pester/Pester) 中的 [PowerShell 库](https://www.powershellgallery.com/packages/Pester/)获取 Pester，Windows 10、Windows Server 2016、WMF 5.0 和 WMF 5.1 也随附 Pester。</span><span class="sxs-lookup"><span data-stu-id="af2b6-217">Pester is available in [GitHub](https://github.com/Pester/Pester), the [PowerShell Gallery](https://www.powershellgallery.com/packages/Pester/), and ships in Windows 10, Windows Server 2016, WMF 5.0 and WMF 5.1.</span></span>

<span data-ttu-id="af2b6-218">[GitHub 中的 Pester 项目网站](https://github.com/Pester/Pester)收录了有关如何编写 Pester 测试的实用文档，从入门到最佳做法，无所不包。</span><span class="sxs-lookup"><span data-stu-id="af2b6-218">The [Pester project site in GitHub](https://github.com/Pester/Pester) includes good documentation on writing Pester tests, from getting started to best practices.</span></span>

<span data-ttu-id="af2b6-219">[优质资源模块文档](https://github.com/PowerShell/DscResources/blob/master/HighQualityModuleGuidelines.md)强调了测试覆盖率目标，建议的单元测试代码覆盖率为 70%。</span><span class="sxs-lookup"><span data-stu-id="af2b6-219">The targets for test coverage are called out in the [High Quality Resource Module documentation](https://github.com/PowerShell/DscResources/blob/master/HighQualityModuleGuidelines.md), with 70% unit test code coverage recommended.</span></span>

## <a name="include-andor-link-to-license-terms"></a><span data-ttu-id="af2b6-220">添加和/或链接到许可条款</span><span class="sxs-lookup"><span data-stu-id="af2b6-220">Include and/or link to license terms</span></span>

<span data-ttu-id="af2b6-221">发布到 PowerShell 库的所有包都必须指定许可条款，或同意受“附件 A”  下[使用条款](https://www.powershellgallery.com/policies/Terms)中许可证的约束。指定不同许可条款的最佳方法是在 PSData  中使用 LicenseURI  ，从而提供许可条款链接。</span><span class="sxs-lookup"><span data-stu-id="af2b6-221">All packages published to the PowerShell Gallery must specify the license terms, or be bound by the license included in the [Terms of Use](https://www.powershellgallery.com/policies/Terms) under **Exhibit A**. The best approach to specifying a different license is to provide a link to the license using the **LicenseURI** in **PSData**.</span></span> <span data-ttu-id="af2b6-222">有关详细信息，请参阅[包清单和库 UI](package-manifest-affecting-ui.md)。</span><span class="sxs-lookup"><span data-stu-id="af2b6-222">For more information, see [Packages manifest and Gallery UI](package-manifest-affecting-ui.md).</span></span>

```powershell
PrivateData = @{
    PSData = @{

        # Tags applied to this module. These help with module discovery in online galleries.
        Tags = @('.net','acl','active-directory')

        # A URL to the license for this module.
        LicenseUri = 'http://www.apache.org/licenses/LICENSE-2.0'
```

## <a name="sign-your-code"></a><span data-ttu-id="af2b6-223">对代码进行签名</span><span class="sxs-lookup"><span data-stu-id="af2b6-223">Sign your code</span></span>

<span data-ttu-id="af2b6-224">代码签名不仅可以让用户对包发行者寄予最大的信任，并能确保用户获取的代码副本与发行者发布的完全一样。</span><span class="sxs-lookup"><span data-stu-id="af2b6-224">Code signing provides users with the highest level of assurance for who published the package, and that the copy of the code they acquire is exactly what the publisher released.</span></span> <span data-ttu-id="af2b6-225">若要详细了解代码签名的一般概念，请参阅[代码签名简介](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537361(v=vs.85))。</span><span class="sxs-lookup"><span data-stu-id="af2b6-225">To learn more about code signing generally, see [Introduction to Code Signing](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537361(v=vs.85)).</span></span>
<span data-ttu-id="af2b6-226">PowerShell 支持通过以下两种主要方法来验证代码签名：</span><span class="sxs-lookup"><span data-stu-id="af2b6-226">PowerShell supports validation of code signing through two primary approaches:</span></span>

- <span data-ttu-id="af2b6-227">对脚本文件进行签名</span><span class="sxs-lookup"><span data-stu-id="af2b6-227">Signing script files</span></span>
- <span data-ttu-id="af2b6-228">对模块进行目录签名</span><span class="sxs-lookup"><span data-stu-id="af2b6-228">Catalog signing a module</span></span>

<span data-ttu-id="af2b6-229">对 PowerShell 文件进行签名是一种由来已久的方法，可确保在执行的代码是由可靠的源生成，并且尚未经过修改。</span><span class="sxs-lookup"><span data-stu-id="af2b6-229">Signing PowerShell files is a well-established approach to ensuring that the code being executed was produced by a reliable source, and hasn't been modified.</span></span> <span data-ttu-id="af2b6-230">[关于签名](/powershell/module/microsoft.powershell.core/about/about_signing)一文详细介绍了如何对 PowerShell 脚本文件进行签名。</span><span class="sxs-lookup"><span data-stu-id="af2b6-230">Details on how to sign PowerShell script files is covered in the [About Signing](/powershell/module/microsoft.powershell.core/about/about_signing) article.</span></span> <span data-ttu-id="af2b6-231">总而言之，可以向 PowerShell 在加载脚本时验证的任何 `.PS1` 文件添加签名。</span><span class="sxs-lookup"><span data-stu-id="af2b6-231">In overview, a signature can be added to any `.PS1` file that PowerShell validates when the script is loaded.</span></span> <span data-ttu-id="af2b6-232">可以使用[执行策略](/powershell/module/microsoft.powershell.core/about/about_execution_policies) cmdlet 来约束 PowerShell，以确保使用已签名脚本。</span><span class="sxs-lookup"><span data-stu-id="af2b6-232">PowerShell can be constrained using the [Execution Policy](/powershell/module/microsoft.powershell.core/about/about_execution_policies) cmdlets to ensure use of signed scripts.</span></span>

<span data-ttu-id="af2b6-233">对模块进行目录签名是 PowerShell 版本 5.1 中新增的功能。</span><span class="sxs-lookup"><span data-stu-id="af2b6-233">Catalog signing modules is a feature added to PowerShell in version 5.1.</span></span> <span data-ttu-id="af2b6-234">[目录 Cmdlet](/powershell/scripting/wmf/whats-new/new-updated-cmdlets#catalog-cmdlets) 一文中介绍了如何对模块进行签名。</span><span class="sxs-lookup"><span data-stu-id="af2b6-234">How to sign a module is covered in the [Catalog Cmdlets](/powershell/scripting/wmf/whats-new/new-updated-cmdlets#catalog-cmdlets) article.</span></span>
<span data-ttu-id="af2b6-235">总而言之，对模块进行目录签名是通过创建目录文件（其中包含模块中每个文件的哈希值），再对此文件进行签名完成的。</span><span class="sxs-lookup"><span data-stu-id="af2b6-235">In overview, catalog signing is done by creating a catalog file, which contains a hash value for every file in the module, and then signing that file.</span></span>

<span data-ttu-id="af2b6-236">PowerShellGet  `Publish-Module`、`Install-Module` 和 `Update-Module` cmdlet 将检查签名，以确保签名有效，然后确认每个包的哈希值是否与目录中的值一致。</span><span class="sxs-lookup"><span data-stu-id="af2b6-236">The **PowerShellGet** `Publish-Module`, `Install-Module`, and `Update-Module` cmdlets will check the signature to ensure it's valid, then confirm that the hash value for each package matches what is in the catalog.</span></span> <span data-ttu-id="af2b6-237">`Save-Module` 不验证签名。</span><span class="sxs-lookup"><span data-stu-id="af2b6-237">`Save-Module` doesn't validate a signature.</span></span> <span data-ttu-id="af2b6-238">如果在系统中安装了旧版模块，`Install-Module` 将确认新版本的签名颁发机构是否与之前安装的版本一致。</span><span class="sxs-lookup"><span data-stu-id="af2b6-238">If a previous version of the module is installed on the system, `Install-Module` will confirm that the signing authority for the new version matches what was previously installed.</span></span> <span data-ttu-id="af2b6-239">如果未对包进行目录签名，`Install-Module` 和 `Update-Module` 将对 `.PSD1` 文件使用签名。</span><span class="sxs-lookup"><span data-stu-id="af2b6-239">`Install-Module` and `Update-Module` will use the signature on a `.PSD1` file if the package isn't catalog signed.</span></span> <span data-ttu-id="af2b6-240">目录签名可与签名脚本文件结合使用，但不会替换它。</span><span class="sxs-lookup"><span data-stu-id="af2b6-240">Catalog signing works with, but doesn't replace signing script files.</span></span> <span data-ttu-id="af2b6-241">PowerShell 不会在模块加载时验证目录签名。</span><span class="sxs-lookup"><span data-stu-id="af2b6-241">PowerShell doesn't validate catalog signatures at module load time.</span></span>

## <a name="follow-semver-guidelines-for-versioning"></a><span data-ttu-id="af2b6-242">遵循 SemVer 指南进行版本控制</span><span class="sxs-lookup"><span data-stu-id="af2b6-242">Follow SemVer guidelines for versioning</span></span>

<span data-ttu-id="af2b6-243">[SemVer](https://semver.org/) 是一项公共约定，说明了如何生成并更改版本，以便可以轻松解读更改。</span><span class="sxs-lookup"><span data-stu-id="af2b6-243">[SemVer](https://semver.org/) is a public convention that describes how to structure and change a version to allow easy interpretation of changes.</span></span> <span data-ttu-id="af2b6-244">清单数据中必须包含的包的版本。</span><span class="sxs-lookup"><span data-stu-id="af2b6-244">The version for your package must be included in the manifest data.</span></span>

- <span data-ttu-id="af2b6-245">版本应为三个用句点隔开的数字块，如 `0.1.1` 或 `4.11.192`。</span><span class="sxs-lookup"><span data-stu-id="af2b6-245">The version should be structured as three numeric blocks separated by periods, as in `0.1.1` or `4.11.192`.</span></span>
- <span data-ttu-id="af2b6-246">以 `0` 开头的版本表明包尚无法用于生产，当 0 为唯一使用的数字时，第一个数字只应以 `0` 开头。</span><span class="sxs-lookup"><span data-stu-id="af2b6-246">Versions starting with `0` indicate that the package isn't yet production ready, and the first number should only begin with `0` if that's the only number used.</span></span>
- <span data-ttu-id="af2b6-247">第一个数字中的更改（例如，从 `1.9.9999` 更改为 `2.0.0`）表明为主要和重大版本更改。</span><span class="sxs-lookup"><span data-stu-id="af2b6-247">Changes in the first number (`1.9.9999` to `2.0.0`) indicate major and breaking changes between the versions.</span></span>
- <span data-ttu-id="af2b6-248">第二个数字块中的更改（例如，从 `1.1` 更改为 `1.2`）表明为功能级更改，如将新的 cmdlet 添加到模块。</span><span class="sxs-lookup"><span data-stu-id="af2b6-248">Changes to the second number (`1.1` to `1.2`) indicate feature-level changes, such as adding new cmdlets to a module.</span></span>
- <span data-ttu-id="af2b6-249">第三个数字块中的更改表明为非重大更改，如新参数、更新后的示例或新测试。</span><span class="sxs-lookup"><span data-stu-id="af2b6-249">Changes to the third number indicate non-breaking changes, such as new parameters, updated samples, or new tests.</span></span>
- <span data-ttu-id="af2b6-250">列出版本时，PowerShell 会将版本作为字符串进行排序，因此 `1.01.0` 将被视为大于 `1.001.0`。</span><span class="sxs-lookup"><span data-stu-id="af2b6-250">When listing versions, PowerShell will sort the versions as strings, so `1.01.0` will be treated as greater than `1.001.0`.</span></span>

<span data-ttu-id="af2b6-251">PowerShell 的创建时间先于 SemVer 发布时间，因此它支持大多数但非所有 SemVer 元素，具体而言：</span><span class="sxs-lookup"><span data-stu-id="af2b6-251">PowerShell was created before SemVer was published, so it provides support for most but not all elements of SemVer, specifically:</span></span>

- <span data-ttu-id="af2b6-252">它不支持在版本号中使用预发布字符串。</span><span class="sxs-lookup"><span data-stu-id="af2b6-252">It doesn't support prerelease strings in version numbers.</span></span> <span data-ttu-id="af2b6-253">如果发行者希望在提供版本 `1.0.0` 之后提供新的主要版本的预览版本，这就非常有用。</span><span class="sxs-lookup"><span data-stu-id="af2b6-253">This is useful when a publisher wishes to deliver a preview release of a new major version after providing a version `1.0.0`.</span></span> <span data-ttu-id="af2b6-254">今后发布的 PowerShell 库和 PowerShellGet  cmdlet 将支持这样做。</span><span class="sxs-lookup"><span data-stu-id="af2b6-254">This will be supported in a future release of the PowerShell Gallery and **PowerShellGet** cmdlets.</span></span>
- <span data-ttu-id="af2b6-255">PowerShell 和 PowerShell 库允许使用包含 1、2 和 4 段的版本字符串。</span><span class="sxs-lookup"><span data-stu-id="af2b6-255">PowerShell and the PowerShell Gallery allow version strings with 1, 2, and 4 segments.</span></span> <span data-ttu-id="af2b6-256">许多早期模块并未遵循这些指南，并且 Microsoft 产品版本在第 4 个数字块中包含生成信息（例如，`5.1.14393.1066`）。</span><span class="sxs-lookup"><span data-stu-id="af2b6-256">Many early modules did not follow the guidelines, and product releases from Microsoft include build information as a 4th block of numbers (for example `5.1.14393.1066`).</span></span> <span data-ttu-id="af2b6-257">从版本控制的角度来看，这些差异将被忽略。</span><span class="sxs-lookup"><span data-stu-id="af2b6-257">From a versioning standpoint, these differences are ignored.</span></span>

## <a name="test-using-a-local-repository"></a><span data-ttu-id="af2b6-258">使用本地存储库进行测试</span><span class="sxs-lookup"><span data-stu-id="af2b6-258">Test using a local repository</span></span>

<span data-ttu-id="af2b6-259">PowerShell 库的设计目标不是成为用于测试发布过程的目标。</span><span class="sxs-lookup"><span data-stu-id="af2b6-259">The PowerShell Gallery isn't designed to be a target for testing the publishing process.</span></span> <span data-ttu-id="af2b6-260">测试发布到 PowerShell 库的端到端过程，其最佳方法是自行设置并使用本地存储库。</span><span class="sxs-lookup"><span data-stu-id="af2b6-260">The best way to test out the end-to-end process of publishing to the PowerShell Gallery is to set up and use your own local repository.</span></span> <span data-ttu-id="af2b6-261">这可以通过多种方式实现，包括：</span><span class="sxs-lookup"><span data-stu-id="af2b6-261">This can be done in a few ways, including:</span></span>

- <span data-ttu-id="af2b6-262">使用 GitHub 中的 [PS 专用库项目](https://github.com/PowerShell/PSPrivateGallery)设置本地 PowerShell 库实例。</span><span class="sxs-lookup"><span data-stu-id="af2b6-262">Set up a local PowerShell Gallery instance, using the [PS Private Gallery project](https://github.com/PowerShell/PSPrivateGallery) in GitHub.</span></span> <span data-ttu-id="af2b6-263">此预览项目有助于设置可控制并用于测试的 PowerShell 库实例。</span><span class="sxs-lookup"><span data-stu-id="af2b6-263">This preview project will help you set up an instance of the PowerShell Gallery that you can control, and use for your tests.</span></span>
- <span data-ttu-id="af2b6-264">设置[内部 Nuget 存储库](https://blogs.msdn.microsoft.com/powershell/2014/05/20/setting-up-an-internal-powershellget-repository/)。</span><span class="sxs-lookup"><span data-stu-id="af2b6-264">Set up an [internal Nuget repository](https://blogs.msdn.microsoft.com/powershell/2014/05/20/setting-up-an-internal-powershellget-repository/).</span></span>
  <span data-ttu-id="af2b6-265">需要执行更多工作才能完成此设置，但具有以下优点：验证更多的要求，特别是验证 API 密钥的使用以及发布时目标中是否存在依赖关系。</span><span class="sxs-lookup"><span data-stu-id="af2b6-265">This will require more work to set up, but will have the advantage of validating a few more of the requirements, notably validating use of an API key, and whether or not dependencies are present in the target when you publish.</span></span>
- <span data-ttu-id="af2b6-266">将文件共享设置为“存储库”  测试。</span><span class="sxs-lookup"><span data-stu-id="af2b6-266">Set up a file share as the test **repository**.</span></span> <span data-ttu-id="af2b6-267">此设置很容易完成，但由于是文件共享，因此不会发生如上所示的验证。</span><span class="sxs-lookup"><span data-stu-id="af2b6-267">This is easy to set up, but since it's a file share, the validations noted above will not take place.</span></span> <span data-ttu-id="af2b6-268">这种情况下，一个潜在的优点是文件共享不会检查必需的 API 密钥，因此可以使用发布到 PowerShell 库时所用的密钥。</span><span class="sxs-lookup"><span data-stu-id="af2b6-268">One potential advantage in this case is that the file share doesn't check the required API key, so you can use the same key you would use to publish to the PowerShell Gallery.</span></span>

<span data-ttu-id="af2b6-269">采用这些解决方案中的任何一种，使用 `Register-PSRepository` 定义新的存储库  （在 `Publish-Module` 的 `-Repository` 参数中会用到该存储库）。</span><span class="sxs-lookup"><span data-stu-id="af2b6-269">With any of these solutions, use `Register-PSRepository` to define a new **repository**, which you use in the `-Repository` parameter for `Publish-Module`.</span></span>

<span data-ttu-id="af2b6-270">有关测试发布的另外一点：在运营团队的帮助下才能删除发布到 PowerShell 库的包，该团队会确认没有任何内容依赖于要发布的包。</span><span class="sxs-lookup"><span data-stu-id="af2b6-270">One additional point about test publishing: any package you publish to the PowerShell Gallery can't be deleted without help from the operations team, who will confirm that nothing is dependent upon the package you wish to publish.</span></span> <span data-ttu-id="af2b6-271">考虑到该原因，我们不支持将 PowerShell 库作为测试目标，并将与进行此操作的任何发布者联系。</span><span class="sxs-lookup"><span data-stu-id="af2b6-271">For that reason, we don't support the PowerShell Gallery as a testing target, and will contact any publisher who does so.</span></span>

## <a name="use-powershellget-to-publish"></a><span data-ttu-id="af2b6-272">使用 PowerShellGet 发布</span><span class="sxs-lookup"><span data-stu-id="af2b6-272">Use PowerShellGet to publish</span></span>

<span data-ttu-id="af2b6-273">在使用 PowerShell 库时，强烈建议发布者使用 `Publish-Module` 和 `Publish-Script`。</span><span class="sxs-lookup"><span data-stu-id="af2b6-273">It's strongly recommended that publishers use the `Publish-Module` and `Publish-Script` cmdlets when working with the PowerShell Gallery.</span></span> <span data-ttu-id="af2b6-274">创建 PowerShellGet  的目的是，让你无需记住有关从中安装和发布到 PowerShell 库的重要详细信息。</span><span class="sxs-lookup"><span data-stu-id="af2b6-274">**PowerShellGet** was created to help you avoid remembering important details about installing from and publishing to the PowerShell Gallery.</span></span> <span data-ttu-id="af2b6-275">有时，发布者会选择跳过 PowerShellGet  并使用 NuGet  客户端或 PackageManagement  cmdlet，而不是 Publish-Module`Publish-Module`。</span><span class="sxs-lookup"><span data-stu-id="af2b6-275">On occasion, publishers have chosen to skip **PowerShellGet** and use the **NuGet** client, or **PackageManagement** cmdlets, instead of `Publish-Module`.</span></span> <span data-ttu-id="af2b6-276">这会使很多详细信息轻易被漏掉，进而导致各种支持请求。</span><span class="sxs-lookup"><span data-stu-id="af2b6-276">There are a number of details that are easily missed, which results in a variety of support requests.</span></span>

<span data-ttu-id="af2b6-277">如果由于某种原因而无法使用 `Publish-Module` 或 `Publish-Script`，请告知我们。</span><span class="sxs-lookup"><span data-stu-id="af2b6-277">If there's a reason that you can't use `Publish-Module` or `Publish-Script`, please let us know.</span></span>
<span data-ttu-id="af2b6-278">在 PowerShellGet  GitHub 存储库中发布一个问题，并提供导致你选择 NuGet  或 PackageManagement  的详细信息。</span><span class="sxs-lookup"><span data-stu-id="af2b6-278">File an issue in the **PowerShellGet** GitHub repo, and provide the details that cause you to choose **NuGet** or **PackageManagement**.</span></span>

## <a name="recommended-workflow"></a><span data-ttu-id="af2b6-279">建议的工作流</span><span class="sxs-lookup"><span data-stu-id="af2b6-279">Recommended workflow</span></span>

<span data-ttu-id="af2b6-280">我们已总结出适用于在 PowerShell 库中发布的包的最成功方法，如下所述：</span><span class="sxs-lookup"><span data-stu-id="af2b6-280">The most successful approach we have found for packages published to the PowerShell Gallery is this:</span></span>

- <span data-ttu-id="af2b6-281">在开放源代码项目网站中进行初始开发。</span><span class="sxs-lookup"><span data-stu-id="af2b6-281">Do initial development in an open-source project site.</span></span> <span data-ttu-id="af2b6-282">PowerShell 团队使用 GitHub。</span><span class="sxs-lookup"><span data-stu-id="af2b6-282">The PowerShell Team uses GitHub.</span></span>
- <span data-ttu-id="af2b6-283">使用审阅者的反馈和 [Powershell 脚本分析器](https://aka.ms/psscriptanalyzer)，让代码处于稳定状态。</span><span class="sxs-lookup"><span data-stu-id="af2b6-283">Use feedback from reviewers and [Powershell Script Analyzer](https://aka.ms/psscriptanalyzer) to get the code to stable state.</span></span>
- <span data-ttu-id="af2b6-284">添加文档，告知其他人如何使用项。</span><span class="sxs-lookup"><span data-stu-id="af2b6-284">Include documentation, so others know how to use your work.</span></span>
- <span data-ttu-id="af2b6-285">使用本地存储库测试发布操作。</span><span class="sxs-lookup"><span data-stu-id="af2b6-285">Test out the publishing action using a local repository.</span></span>
- <span data-ttu-id="af2b6-286">将稳定版或 Alpha 版本发布到 PowerShell 库中，同时确保添加文档和项目网站链接。</span><span class="sxs-lookup"><span data-stu-id="af2b6-286">Publish a stable or Alpha release to the PowerShell Gallery, making sure to include the documentation and link to your project site.</span></span>
- <span data-ttu-id="af2b6-287">收集反馈并循环访问项目网站中的代码，再将稳定更新发布到 PowerShell 库中。</span><span class="sxs-lookup"><span data-stu-id="af2b6-287">Gather feedback and iterate on the code in your project site, then publish stable updates to the PowerShell Gallery.</span></span>
- <span data-ttu-id="af2b6-288">在项目和模块中添加示例和 Pester 测试。</span><span class="sxs-lookup"><span data-stu-id="af2b6-288">Add examples and Pester tests in your project and your module.</span></span>
- <span data-ttu-id="af2b6-289">决定是否要对包进行代码签名。</span><span class="sxs-lookup"><span data-stu-id="af2b6-289">Decide if you want to code sign your package.</span></span>
- <span data-ttu-id="af2b6-290">如果认为项目可用于生产环境，请将 `1.0.0` 版本发布到 PowerShell 库中。</span><span class="sxs-lookup"><span data-stu-id="af2b6-290">When you feel the project is ready to use in a production environment, publish a `1.0.0` version to the PowerShell Gallery.</span></span>
- <span data-ttu-id="af2b6-291">继续收集反馈，并根据用户输入循环访问代码。</span><span class="sxs-lookup"><span data-stu-id="af2b6-291">Continue to gather feedback and iterate on your code based on user input.</span></span>
