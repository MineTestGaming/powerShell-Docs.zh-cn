---
ms.date: 07/10/2019
keywords: jea,powershell,安全性
title: JEA 安全注意事项
description: 由于 JEA 允许这些用户在没有拥有完整管理员权限的情况下运行管理员命令，因此你可从高特权安全组中删除这些用户。
ms.openlocfilehash: f65f9d6c6620261de0a9c8de7812637565ca1806
ms.sourcegitcommit: 9080316e3ca4f11d83067b41351531672b667b7a
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/24/2020
ms.locfileid: "92501569"
---
# <a name="jea-security-considerations"></a><span data-ttu-id="cfd54-104">JEA 安全注意事项</span><span class="sxs-lookup"><span data-stu-id="cfd54-104">JEA Security Considerations</span></span>

<span data-ttu-id="cfd54-105">JEA 通过减少计算机上的永久管理员数量来帮助改善安全状况。</span><span class="sxs-lookup"><span data-stu-id="cfd54-105">JEA helps you improve your security posture by reducing the number of permanent administrators on your machines.</span></span> <span data-ttu-id="cfd54-106">JEA 使用 PowerShell 会话配置来创建用户管理系统的新入口点。</span><span class="sxs-lookup"><span data-stu-id="cfd54-106">JEA uses a PowerShell session configuration to create a new entry point for users to manage the system.</span></span> <span data-ttu-id="cfd54-107">如果用户需要提升（但受限）的计算机访问权限来执行管理任务，则可向他们授予访问 JEA 终结点的权限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-107">Users who need elevated, but not unlimited, access to the machine to do administrative tasks can be granted access to the JEA endpoint.</span></span> <span data-ttu-id="cfd54-108">由于 JEA 允许这些用户在没有拥有完整管理员权限的情况下运行管理员命令，因此你可从高特权安全组中删除这些用户。</span><span class="sxs-lookup"><span data-stu-id="cfd54-108">Since JEA allows these users to run admin commands without having full admin access, you can then remove those users from highly privileged security groups.</span></span>

## <a name="run-as-account"></a><span data-ttu-id="cfd54-109">运行身份帐户</span><span class="sxs-lookup"><span data-stu-id="cfd54-109">Run-As account</span></span>

<span data-ttu-id="cfd54-110">每个 JEA 终结点都具有指定的运行身份帐户  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-110">Each JEA endpoint has a designated **run-as** account.</span></span> <span data-ttu-id="cfd54-111">这是执行连接用户的操作时使用的帐户。</span><span class="sxs-lookup"><span data-stu-id="cfd54-111">This is the account under which the connecting user's actions are executed.</span></span> <span data-ttu-id="cfd54-112">此帐户在[会话配置文件](session-configurations.md)中是可配置的，并且你选择的帐户对终结点的安全性意义重大。</span><span class="sxs-lookup"><span data-stu-id="cfd54-112">This account is configurable in the [session configuration file](session-configurations.md), and the account you choose has a significant bearing on the security of your endpoint.</span></span>

<span data-ttu-id="cfd54-113">建议使用虚拟帐户来配置运行身份帐户  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-113">**Virtual accounts** are the recommended way of configuring the **run-as** account.</span></span> <span data-ttu-id="cfd54-114">虚拟帐户是临时创建的一次性本地帐户，便于连接用户在 JEA 会话期间使用。</span><span class="sxs-lookup"><span data-stu-id="cfd54-114">Virtual accounts are one-time, temporary local accounts that are created for the connecting user to use during the duration of their JEA session.</span></span> <span data-ttu-id="cfd54-115">一旦用户的会话终止，虚拟帐户即废弃且不得再次使用。</span><span class="sxs-lookup"><span data-stu-id="cfd54-115">As soon as their session is terminated, the virtual account is destroyed and can't be used anymore.</span></span> <span data-ttu-id="cfd54-116">连接用户不知道虚拟帐户的凭据。</span><span class="sxs-lookup"><span data-stu-id="cfd54-116">The connecting user doesn't know the credentials for the virtual account.</span></span> <span data-ttu-id="cfd54-117">虚拟帐户不能用于通过远程桌面或不受约束的 PowerShell 终结点等其他方式访问系统。</span><span class="sxs-lookup"><span data-stu-id="cfd54-117">The virtual account can't be used to access the system via other means like Remote Desktop or an unconstrained PowerShell endpoint.</span></span>

<span data-ttu-id="cfd54-118">默认情况下，虚拟帐户属于计算机上的本地管理员组。</span><span class="sxs-lookup"><span data-stu-id="cfd54-118">By default, virtual accounts belong to the local **Administrators** group on the machine.</span></span> <span data-ttu-id="cfd54-119">这将授予他们管理系统中所有内容的全部权限，但这些帐户无权管理网络中的资源。</span><span class="sxs-lookup"><span data-stu-id="cfd54-119">This gives them full rights to manage anything on the system, but no rights to manage resources on the network.</span></span>
<span data-ttu-id="cfd54-120">在向其他计算机进行身份验证时，用户上下文针对本地计算机帐户，而非虚拟帐户。</span><span class="sxs-lookup"><span data-stu-id="cfd54-120">When authenticating with other machines, the user context is that of the local computer account, not the virtual account.</span></span>

<span data-ttu-id="cfd54-121">域控制器是一种特殊情况，因为不存在本地管理员组  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-121">Domain controllers are a special case since there isn't a local **Administrators** group.</span></span> <span data-ttu-id="cfd54-122">然而，虚拟帐户属于域管理员，可管理域控制器上的目录服务  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-122">Instead, virtual accounts belong to **Domain Admins** and can manage the directory services on the domain controller.</span></span> <span data-ttu-id="cfd54-123">域标识在实例化 JEA 会话的域控制器上的使用仍然受限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-123">The domain identity is still restricted for use on the domain controller where the JEA session was instantiated.</span></span> <span data-ttu-id="cfd54-124">任何网络访问似乎都来自域控制器计算机对象。</span><span class="sxs-lookup"><span data-stu-id="cfd54-124">Any network access appears to come from the domain controller computer object instead.</span></span>

<span data-ttu-id="cfd54-125">在这两种情况下，可显式定义虚拟帐户应属于哪些安全组。</span><span class="sxs-lookup"><span data-stu-id="cfd54-125">In both cases, you may explicitly define which security groups the virtual account belongs to.</span></span> <span data-ttu-id="cfd54-126">无需本地或域管理员权限即可完成任务时，这是一个很合适的做法。</span><span class="sxs-lookup"><span data-stu-id="cfd54-126">This is a good practice when the task can be done without local or domain admin privileges.</span></span> <span data-ttu-id="cfd54-127">如果已为管理员定义了安全组，则向该组授予虚拟帐户成员资格。</span><span class="sxs-lookup"><span data-stu-id="cfd54-127">If you already have a security group defined for your admins, grant the virtual account membership to that group.</span></span> <span data-ttu-id="cfd54-128">虚拟帐户组成员资格仅限于工作站和成员服务器上的本地安全组。</span><span class="sxs-lookup"><span data-stu-id="cfd54-128">Virtual account group membership is limited to local security groups on workstation and member servers.</span></span> <span data-ttu-id="cfd54-129">在域控制器上，虚拟帐户必须是域安全组的成员。</span><span class="sxs-lookup"><span data-stu-id="cfd54-129">On domain controllers, virtual accounts must be members of domain security groups.</span></span>
<span data-ttu-id="cfd54-130">将虚拟帐户添加到一个或多个安全组后，该帐户将不再属于默认组（本地或域管理员）。</span><span class="sxs-lookup"><span data-stu-id="cfd54-130">Once the virtual account has been added to one or more security groups, it no longer belongs to the default groups (local or domain admins).</span></span>

<span data-ttu-id="cfd54-131">下表总结了虚拟帐户可能的配置选项和所得到的权限：</span><span class="sxs-lookup"><span data-stu-id="cfd54-131">The following table summarizes the possible configuration options and resulting permissions for virtual accounts:</span></span>

|        <span data-ttu-id="cfd54-132">计算机类型</span><span class="sxs-lookup"><span data-stu-id="cfd54-132">Computer type</span></span>         | <span data-ttu-id="cfd54-133">虚拟帐户组配置</span><span class="sxs-lookup"><span data-stu-id="cfd54-133">Virtual account group configuration</span></span> |                   <span data-ttu-id="cfd54-134">本地用户上下文</span><span class="sxs-lookup"><span data-stu-id="cfd54-134">Local user context</span></span>                    | <span data-ttu-id="cfd54-135">网络用户上下文</span><span class="sxs-lookup"><span data-stu-id="cfd54-135">Network user context</span></span> |
| ---------------------------- | ----------------------------------- | ------------------------------------------------------- | -------------------- |
| <span data-ttu-id="cfd54-136">域控制器</span><span class="sxs-lookup"><span data-stu-id="cfd54-136">Domain controller</span></span>            | <span data-ttu-id="cfd54-137">默认</span><span class="sxs-lookup"><span data-stu-id="cfd54-137">Default</span></span>                             | <span data-ttu-id="cfd54-138">域用户，“ *DOMAIN* \Domain Admins”的成员</span><span class="sxs-lookup"><span data-stu-id="cfd54-138">Domain user, member of ' *DOMAIN* \Domain Admins'</span></span>         | <span data-ttu-id="cfd54-139">计算机帐户</span><span class="sxs-lookup"><span data-stu-id="cfd54-139">Computer account</span></span>     |
| <span data-ttu-id="cfd54-140">域控制器</span><span class="sxs-lookup"><span data-stu-id="cfd54-140">Domain controller</span></span>            | <span data-ttu-id="cfd54-141">域组 A 和域组 B</span><span class="sxs-lookup"><span data-stu-id="cfd54-141">Domain groups A and B</span></span>               | <span data-ttu-id="cfd54-142">域用户，“ *DOMAIN* \A”、“ *DOMAIN* \B”的成员</span><span class="sxs-lookup"><span data-stu-id="cfd54-142">Domain user, member of ' *DOMAIN* \A', ' *DOMAIN* \B'</span></span>       | <span data-ttu-id="cfd54-143">计算机帐户</span><span class="sxs-lookup"><span data-stu-id="cfd54-143">Computer account</span></span>     |
| <span data-ttu-id="cfd54-144">成员服务器或工作站</span><span class="sxs-lookup"><span data-stu-id="cfd54-144">Member server or workstation</span></span> | <span data-ttu-id="cfd54-145">默认</span><span class="sxs-lookup"><span data-stu-id="cfd54-145">Default</span></span>                             | <span data-ttu-id="cfd54-146">本地用户、“ *BUILTIN* \Administrators”的成员</span><span class="sxs-lookup"><span data-stu-id="cfd54-146">Local user, member of ' *BUILTIN* \Administrators'</span></span>        | <span data-ttu-id="cfd54-147">计算机帐户</span><span class="sxs-lookup"><span data-stu-id="cfd54-147">Computer account</span></span>     |
| <span data-ttu-id="cfd54-148">成员服务器或工作站</span><span class="sxs-lookup"><span data-stu-id="cfd54-148">Member server or workstation</span></span> | <span data-ttu-id="cfd54-149">本地组 C 和 D</span><span class="sxs-lookup"><span data-stu-id="cfd54-149">Local groups C and D</span></span>                | <span data-ttu-id="cfd54-150">本地用户、“ *COMPUTER* \C”和“ *COMPUTER* \D”的成员</span><span class="sxs-lookup"><span data-stu-id="cfd54-150">Local user, member of ' *COMPUTER* \C' and ' *COMPUTER* \D'</span></span> | <span data-ttu-id="cfd54-151">计算机帐户</span><span class="sxs-lookup"><span data-stu-id="cfd54-151">Computer account</span></span>     |

<span data-ttu-id="cfd54-152">查看安全审核事件和应用程序事件日志时，可发现每个 JEA 用户会话都有唯一的虚拟帐户。</span><span class="sxs-lookup"><span data-stu-id="cfd54-152">When you look at security audit events and application event logs, you see that each JEA user session has a unique virtual account.</span></span> <span data-ttu-id="cfd54-153">此唯一帐户有助于将 JEA 终结点中的用户操作追溯回运行该命令的原始用户。</span><span class="sxs-lookup"><span data-stu-id="cfd54-153">This unique account helps you track user actions in a JEA endpoint back to the original user who ran the command.</span></span> <span data-ttu-id="cfd54-154">虚拟帐户名称遵循 `WinRM Virtual Users\WinRM_VA_<ACCOUNTNUMBER>_<DOMAIN>_<sAMAccountName>` 格式。例如，域 Contoso 中的用户 Alice 在 JEA 终结点中重启服务时，与任何服务控制管理器事件关联的用户名将为 `WinRM Virtual Users\WinRM_VA_1_contoso_alice` 。</span><span class="sxs-lookup"><span data-stu-id="cfd54-154">Virtual account names follow the format `WinRM Virtual Users\WinRM_VA_<ACCOUNTNUMBER>_<DOMAIN>_<sAMAccountName>` For example, if user **Alice** in domain **Contoso** restarts a service in a JEA endpoint, the username associated with any service control manager events would be `WinRM Virtual Users\WinRM_VA_1_contoso_alice`.</span></span>

<span data-ttu-id="cfd54-155">当成员服务器需要对 JEA 会话中的网络资源具有访问权限时，组托管服务帐户 (gMSA) 十分有用  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-155">**Group-managed service accounts (gMSAs)** are useful when a member server needs to have access to network resources in the JEA session.</span></span> <span data-ttu-id="cfd54-156">例如，JEA 终结点用于控制对其他计算机上托管的 REST API 服务的访问时。</span><span class="sxs-lookup"><span data-stu-id="cfd54-156">For example, when a JEA endpoint is used to control access to a REST API service hosted on a different machine.</span></span> <span data-ttu-id="cfd54-157">可轻松编写函数来调用 REST API，但需要使用网络标识对 API 进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="cfd54-157">It's easy to write functions to invoke the REST APIs, but you need a network identity to authenticate with the API.</span></span> <span data-ttu-id="cfd54-158">使用组托管服务帐户可实现第二个跃点，同时持续控制哪些计算机可使用此帐户。</span><span class="sxs-lookup"><span data-stu-id="cfd54-158">Using a group-managed service account makes the second hop possible while maintaining control over which computers can use the account.</span></span> <span data-ttu-id="cfd54-159">gMSA 帐户所属的安全组（本地或域）定义 gMSA 的有效权限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-159">The effective permissions of the gMSA are defined by the security groups (local or domain) to which the gMSA account belongs.</span></span>

<span data-ttu-id="cfd54-160">JEA 终结点配置为使用 gMSA 时，所有 JEA 用户的操作似乎来自同一个 gMSA。</span><span class="sxs-lookup"><span data-stu-id="cfd54-160">When a JEA endpoint is configured to use a gMSA, the actions of all JEA users appear to come from the same gMSA.</span></span> <span data-ttu-id="cfd54-161">要将操作追溯回特定用户，唯一方法是确定在 PowerShell 会话脚本中运行的命令集。</span><span class="sxs-lookup"><span data-stu-id="cfd54-161">The only way to trace actions back to a specific user is to identify the set of commands run in a PowerShell session transcript.</span></span>

<span data-ttu-id="cfd54-162">未指定运行身份帐户时使用传递凭据  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-162">**Pass-thru credentials** are used when you don't specify a **run-as** account.</span></span> <span data-ttu-id="cfd54-163">PowerShell 使用连接用户的凭据在远程服务器上运行命令。</span><span class="sxs-lookup"><span data-stu-id="cfd54-163">PowerShell uses the connecting user's credential to run commands on the remote server.</span></span> <span data-ttu-id="cfd54-164">这需要你向连接用户授予对特权管理组的直接访问权限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-164">This requires you to grant the connecting user direct access to privileged management groups.</span></span> <span data-ttu-id="cfd54-165">对于 JEA，不推荐此配置  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-165">This configuration is **not** recommended for JEA.</span></span> <span data-ttu-id="cfd54-166">如果连接用户已有管理员权限，则无需使用 JEA，并可通过其他不受约束的方式管理系统。</span><span class="sxs-lookup"><span data-stu-id="cfd54-166">If the connecting user already has admin privileges, they can avoid JEA and manage the system via other, unconstrained means.</span></span> <span data-ttu-id="cfd54-167">有关详细信息，请参阅下一部分来了解如何使 [JEA 不阻止管理员](#jea-doesnt-protect-against-admins)。</span><span class="sxs-lookup"><span data-stu-id="cfd54-167">For more information, see the section below on how [JEA doesn't protect against admins](#jea-doesnt-protect-against-admins).</span></span>

<span data-ttu-id="cfd54-168">通过标准运行身份帐户，可指定运行整个 PowerShell 会话所采用的用户帐户  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-168">**Standard run-as accounts** allow you to specify any user account under which the entire PowerShell session runs.</span></span> <span data-ttu-id="cfd54-169">JEA 不支持使用固定运行身份帐户（具有 `-RunAsCredential` 参数）的’会话配置  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-169">Session configurations using fixed **run-as** accounts (with the `-RunAsCredential` parameter) aren't JEA-aware.</span></span> <span data-ttu-id="cfd54-170">角色定义不再按预期方式运行。</span><span class="sxs-lookup"><span data-stu-id="cfd54-170">Role definitions no longer function as expected.</span></span> <span data-ttu-id="cfd54-171">有权访问该终结点的每位用户都分配到同一角色。</span><span class="sxs-lookup"><span data-stu-id="cfd54-171">Every user authorized to access the endpoint is assigned the same role.</span></span>

<span data-ttu-id="cfd54-172">由于很难将操作追溯回特定用户并且缺少将用户映射到角色的支持，因此不得对 JEA 终结点使用 RunAsCredential  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-172">You shouldn't use a **RunAsCredential** on a JEA endpoint because it's difficult to trace actions back to specific users and lacks support for mapping users to roles.</span></span>

## <a name="winrm-endpoint-acl"></a><span data-ttu-id="cfd54-173">WinRM 终结点 ACL</span><span class="sxs-lookup"><span data-stu-id="cfd54-173">WinRM Endpoint ACL</span></span>

<span data-ttu-id="cfd54-174">与常规 PowerShell 远程处理终结点一样，每个 JEA 终结点都有单独的访问控制列表 (ACL)，它用于控制哪些用户可通过 JEA 终结点进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="cfd54-174">As with regular PowerShell remoting endpoints, each JEA endpoint has a separate access control list (ACL) that controls who can authenticate with the JEA endpoint.</span></span> <span data-ttu-id="cfd54-175">如果配置错误，受信任的用户可能无法访问 JEA 终结点，而不受信任的用户可能获得访问权限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-175">If improperly configured, trusted users may not be able to access the JEA endpoint and untrusted users may have access.</span></span> <span data-ttu-id="cfd54-176">WinRM ACL 不影响用户到 JEA 角色的映射。</span><span class="sxs-lookup"><span data-stu-id="cfd54-176">The WinRM ACL doesn't affect the mapping of users to JEA roles.</span></span> <span data-ttu-id="cfd54-177">映射由用于注册终结点的会话配置文件中的“RoleDefinitions”字段控制  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-177">Mapping is controlled by the **RoleDefinitions** field in the session configuration file used to register the endpoint.</span></span>

<span data-ttu-id="cfd54-178">默认情况下，当 JEA 终结点具有多个角色功能时，WinRM ACL 配置为允许访问所有映射的用户。</span><span class="sxs-lookup"><span data-stu-id="cfd54-178">By default, when a JEA endpoint has multiple role capabilities, the WinRM ACL is configured to allow access to all mapped users.</span></span> <span data-ttu-id="cfd54-179">例如，使用以下命令配置的 JEA 会话授予对 `CONTOSO\JEA_Lev1` 和 `CONTOSO\JEA_Lev2` 的完全访问权限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-179">For example, a JEA session configured using the following commands grants full access to `CONTOSO\JEA_Lev1` and `CONTOSO\JEA_Lev2`.</span></span>

```powershell
$roles = @{ 'CONTOSO\JEA_Lev1' = 'Lev1Role'; 'CONTOSO\JEA_Lev2' = 'Lev2Role' }
New-PSSessionConfigurationFile -Path '.\jea.pssc' -SessionType RestrictedRemoteServer -RoleDefinitions $roles -RunAsVirtualAccount
Register-PSSessionConfiguration -Path '.\jea.pssc' -Name 'MyJEAEndpoint'
```

<span data-ttu-id="cfd54-180">可以使用 [Get-pssessionconfiguration](/powershell/module/microsoft.powershell.core/get-pssessionconfiguration) cmdlet 审核用户权限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-180">You can audit user permissions with the [Get-PSSessionConfiguration](/powershell/module/microsoft.powershell.core/get-pssessionconfiguration) cmdlet.</span></span>

```powershell
Get-PSSessionConfiguration -Name 'MyJEAEndpoint' | Select-Object Permission
```

```Output
Permission
----------
CONTOSO\JEA_Lev1 AccessAllowed
CONTOSO\JEA_Lev2 AccessAllowed
```

<span data-ttu-id="cfd54-181">若要更改哪些用户具有访问权限，请运行 `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -ShowSecurityDescriptorUI` 进行交互式提示或运行 `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -SecurityDescriptorSddl <SDDL string>` 来更新权限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-181">To change which users have access, run either `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -ShowSecurityDescriptorUI` for an interactive prompt or `Set-PSSessionConfiguration -Name 'MyJEAEndpoint' -SecurityDescriptorSddl <SDDL string>` to update the permissions.</span></span> <span data-ttu-id="cfd54-182">用户至少需要调用  权限才能访问 JEA 终结点。</span><span class="sxs-lookup"><span data-stu-id="cfd54-182">Users need at least *Invoke* rights to access the JEA endpoint.</span></span>

<span data-ttu-id="cfd54-183">可创建未将已定义角色映射到有权访问的每个用户的 JEA 终结点。</span><span class="sxs-lookup"><span data-stu-id="cfd54-183">It's possible to create a JEA endpoint that doesn't map a defined role to every user that has access.</span></span> <span data-ttu-id="cfd54-184">这些用户可发起 JEA 会话，但仅有权访问默认 cmdlet。</span><span class="sxs-lookup"><span data-stu-id="cfd54-184">These users can start a JEA session, but only have access to the default cmdlets.</span></span> <span data-ttu-id="cfd54-185">可以通过运行 `Get-PSSessionCapability` 来审核 JEA 终结点中的用户权限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-185">You can audit user permissions in a JEA endpoint by running `Get-PSSessionCapability`.</span></span> <span data-ttu-id="cfd54-186">有关详细信息，请参阅 [JEA 审核和报告](audit-and-report.md)。</span><span class="sxs-lookup"><span data-stu-id="cfd54-186">For more information, see [Auditing and Reporting on JEA](audit-and-report.md).</span></span>

## <a name="least-privilege-roles"></a><span data-ttu-id="cfd54-187">最小特权角色</span><span class="sxs-lookup"><span data-stu-id="cfd54-187">Least privilege roles</span></span>

<span data-ttu-id="cfd54-188">设计 JEA 角色时，请务必记住后台运行的虚拟帐户或组托管服务帐户可不受限制地访问本地计算机。</span><span class="sxs-lookup"><span data-stu-id="cfd54-188">When designing JEA roles, it's important to remember that the virtual and group-managed service accounts running behind the scenes can have unrestricted access to the local machine.</span></span> <span data-ttu-id="cfd54-189">JEA 角色功能有助于限制可在该特权上下文中运行的命令和应用程序。</span><span class="sxs-lookup"><span data-stu-id="cfd54-189">JEA role capabilities help limit the commands and applications that can be run in that privileged context.</span></span>
<span data-ttu-id="cfd54-190">设计不当的角色可允许运行危险命令，该命令可能允许用户冲破 JEA 边界或获得对敏感信息的访问权限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-190">Improperly designed roles can allow dangerous commands that may permit a user to break out of the JEA boundaries or obtain access to sensitive information.</span></span>

<span data-ttu-id="cfd54-191">例如，考虑以下角色功能事项：</span><span class="sxs-lookup"><span data-stu-id="cfd54-191">For example, consider the following role capability entry:</span></span>

```powershell
@{
    VisibleCmdlets = 'Microsoft.PowerShell.Management\*-Process'
}
```

<span data-ttu-id="cfd54-192">通过此角色功能，用户可从 Microsoft.PowerShell.Management 模块使用 Process 名词运行任何 PowerShell cmdlet 。</span><span class="sxs-lookup"><span data-stu-id="cfd54-192">This role capability allows users to run any PowerShell cmdlet with the noun **Process** from the **Microsoft.PowerShell.Management** module.</span></span> <span data-ttu-id="cfd54-193">用户可能需要访问一些 cmdlet，例如访问 `Get-Process` 来了解系统上正在运行哪些应用程序，以及访问 `Stop-Process` 来终止未响应的应用程序。</span><span class="sxs-lookup"><span data-stu-id="cfd54-193">Users may need to access cmdlets like `Get-Process` to see what applications are running on the system and `Stop-Process` to kill applications that aren't responding.</span></span> <span data-ttu-id="cfd54-194">但是，此项还允许访问 `Start-Process`，以用于启动具有完全管理员权限的任意程序。</span><span class="sxs-lookup"><span data-stu-id="cfd54-194">However, this entry also allows `Start-Process`, which can be used to start up an arbitrary program with full administrator permissions.</span></span> <span data-ttu-id="cfd54-195">该程序不需要在系统上进行本地安装。</span><span class="sxs-lookup"><span data-stu-id="cfd54-195">The program doesn't need to be installed locally on the system.</span></span> <span data-ttu-id="cfd54-196">已连接的用户可从文件共享启动程序，这向用户提供本地管理员权限，还会运行恶意软件等等。</span><span class="sxs-lookup"><span data-stu-id="cfd54-196">A connected user could start a program from a file share that gives the user local admin privileges, runs malware, and more.</span></span>

<span data-ttu-id="cfd54-197">此相同角色功能的更安全版本如下所示：</span><span class="sxs-lookup"><span data-stu-id="cfd54-197">A more secure version of this same role capability would look like:</span></span>

```powershell
@{
    VisibleCmdlets = 'Microsoft.PowerShell.Management\Get-Process', 'Microsoft.PowerShell.Management\Stop-Process'
}
```

<span data-ttu-id="cfd54-198">不要在角色功能中使用通配符。</span><span class="sxs-lookup"><span data-stu-id="cfd54-198">Avoid using wildcards in role capabilities.</span></span> <span data-ttu-id="cfd54-199">请务必定期[审计有效用户权限](audit-and-report.md#check-effective-rights-for-a-specific-user)，了解用户可访问哪些命令。</span><span class="sxs-lookup"><span data-stu-id="cfd54-199">Be sure to regularly [audit effective user permissions](audit-and-report.md#check-effective-rights-for-a-specific-user) to understand which commands are accessible to the user.</span></span>

## <a name="jea-doesnt-protect-against-admins"></a><span data-ttu-id="cfd54-200">JEA 不阻止管理员</span><span class="sxs-lookup"><span data-stu-id="cfd54-200">JEA doesn't protect against admins</span></span>

<span data-ttu-id="cfd54-201">JEA 的核心原则之一是允许非管理员执行某些管理员任务。</span><span class="sxs-lookup"><span data-stu-id="cfd54-201">One of the core principles of JEA is that it allows non-admins to do some admin tasks.</span></span> <span data-ttu-id="cfd54-202">JEA 不阻止已具有管理员特权的用户。</span><span class="sxs-lookup"><span data-stu-id="cfd54-202">JEA doesn't protect against users who already have administrator privileges.</span></span> <span data-ttu-id="cfd54-203">属于域管理员、本地管理员或其他高权限组的用户可通过其他方式规避 JEA 的保护  。</span><span class="sxs-lookup"><span data-stu-id="cfd54-203">Users who belong **Domain Admins** , local **Administrators** , or other highly privileged groups can circumvent JEA's protections via another means.</span></span> <span data-ttu-id="cfd54-204">例如，他们可使用 RDP 进行登录、使用远程 MMC 控制台，或连接到不受约束的 PowerShell 终结点。</span><span class="sxs-lookup"><span data-stu-id="cfd54-204">For example, they could sign in with RDP, use remote MMC consoles, or connect to unconstrained PowerShell endpoints.</span></span> <span data-ttu-id="cfd54-205">此外，系统上的本地管理员还可修改 JEA 配置以允许其他用户，或者更改角色功能，以扩大其 JEA 会话中用户可执行的操作范围。</span><span class="sxs-lookup"><span data-stu-id="cfd54-205">Also, local admins on a system can modify JEA configurations to allow additional users or change a role capability to extend the scope of what a user can do in their JEA session.</span></span> <span data-ttu-id="cfd54-206">请务必评估 JEA 用户的延伸权限，了解他们是否可通过其他方式获得对系统的特许访问权限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-206">It's important to evaluate your JEA users' extended permissions to see if there are other ways to gain privileged access to the system.</span></span>

<span data-ttu-id="cfd54-207">一种常见做法是使用 JEA 进行常规的日常维护，并且获得实时特许访问管理解决方案，使用户在紧急情况下能够临时成为本地管理员。</span><span class="sxs-lookup"><span data-stu-id="cfd54-207">A common practice is to use JEA for regular day-to-day maintenance and have a just-in-time, privileged access management solution that allows users to temporarily become local admins in emergency situations.</span></span> <span data-ttu-id="cfd54-208">这有助于确保用户不会成为系统的永久管理员，只有当且仅当他们完成记录这些权限使用情况的工作流时，才能获得这些权限。</span><span class="sxs-lookup"><span data-stu-id="cfd54-208">This helps ensure users aren't permanent admins on the system, but can get those rights if, and only when, they complete a workflow that documents their use of those permissions.</span></span>
